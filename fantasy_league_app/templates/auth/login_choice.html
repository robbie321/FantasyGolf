{% extends 'base.html' %} {% block head %}
<!-- Professional Login Styles -->
<link
  rel="stylesheet"
  href="{{ url_for('static', filename='css/auth/professional_login.css') }}"
/>
<link rel="preconnect" href="https://fonts.googleapis.com" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
<link
  href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap"
  rel="stylesheet"
/>
{% endblock %} {% block content %}
<div class="auth-container">
  <div class="auth-card fade-in">
    <!-- Professional Logo -->
    <div class="auth-logo">
      <img
        src="{{ url_for('static', filename='images/logo/club_logo.png') }}"
        alt="Fantasy Fairways Logo"
      />
    </div>

    <!-- Professional Header -->
    <h1>Welcome Back</h1>
    <p class="subtitle">Sign in to your account to continue</p>

    <!-- Professional Login Tabs -->
    <div class="login-tabs">
      <button class="login-tab-button active" data-tab-target="#user-login">
        <i class="fa-solid fa-user"></i>
        <span>User</span>
      </button>
      <button class="login-tab-button" data-tab-target="#club-login">
        <i class="fa-solid fa-building"></i>
        <span>Club</span>
      </button>
    </div>

    <!-- User Login Tab -->
    <div class="login-tab-content active fade-in" id="user-login">
      <form
        method="POST"
        action="{{ url_for('auth.login_user_account') }}"
        id="user-login-form"
      >
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />

        <div class="form-group">
          <label for="user-email">
            <i class="fa-solid fa-envelope"></i>
            Email Address
          </label>
          <input
            type="email"
            id="user-email"
            name="email"
            placeholder="Enter your email address"
            required
            autocomplete="email"
          />
        </div>

        <div class="form-group">
          <label for="user-password">
            <i class="fa-solid fa-lock"></i>
            Password
          </label>
          <input
            type="password"
            id="user-password"
            name="password"
            placeholder="Enter your password"
            required
            autocomplete="current-password"
          />
        </div>

        <div class="form-group remember-me-group">
          <label class="remember-me-label">
            <input
              type="checkbox"
              id="user-remember-me"
              name="remember_me"
              checked
            />
            <span>Remember me for 1 year</span>
          </label>
        </div>

        <button type="submit" class="btn btn-primary" id="user-login-btn">
          <i class="fa-solid fa-sign-in-alt"></i>
          <span>Sign In</span>
        </button>

        <!-- Display any flash messages for user login -->
        {% with messages =
        get_flashed_messages(category_filter=['user_login_error']) %} {% if
        messages %} {% for message in messages %}
        <div class="error-message">{{ message }}</div>
        {% endfor %} {% endif %} {% endwith %}
      </form>
    </div>

    <!-- Club Login Tab -->
    <div class="login-tab-content" id="club-login">
      <form
        method="POST"
        action="{{ url_for('auth.login_club_account') }}"
        id="club-login-form"
      >
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />

        <div class="form-group">
          <label for="club-email">
            <i class="fa-solid fa-building"></i>
            Club Email
          </label>
          <input
            type="email"
            id="club-email"
            name="email"
            placeholder="Enter your club email"
            required
            autocomplete="email"
          />
        </div>

        <div class="form-group">
          <label for="club-password">
            <i class="fa-solid fa-key"></i>
            Password
          </label>
          <input
            type="password"
            id="club-password"
            name="password"
            placeholder="Enter your password"
            required
            autocomplete="current-password"
          />
        </div>

        <div class="form-group remember-me-group">
          <label class="remember-me-label">
            <input
              type="checkbox"
              id="club-remember-me"
              name="remember_me"
              checked
            />
            <span>Remember me for 1 year</span>
          </label>
        </div>

        <button type="submit" class="btn btn-primary" id="club-login-btn">
          <i class="fa-solid fa-sign-in-alt"></i>
          <span>Sign In</span>
        </button>

        <!-- Display any flash messages for club login -->
        {% with messages =
        get_flashed_messages(category_filter=['club_login_error']) %} {% if
        messages %} {% for message in messages %}
        <div class="error-message">{{ message }}</div>
        {% endfor %} {% endif %} {% endwith %}
      </form>
    </div>

    <!-- Professional Links Section -->
    <div class="auth-links">
      <p>
        <a href="{{ url_for('auth.reset_request') }}">
          <i class="fa-solid fa-question-circle"></i>
          Forgot your password?
        </a>
      </p>
      <p>
        Don't have an account?
        <a href="{{ url_for('auth.register') }}">
          <strong>Register here</strong>
        </a>
      </p>

      {% if current_user.is_authenticated and current_user.is_site_admin %}
      <a href="{{ url_for('admin.admin_dashboard') }}" class="site-admin-link">
        <i class="fa-solid fa-shield-halved"></i>
        Site Admin Login
      </a>
      {% else %}
      <a href="{{ url_for('auth.login_site_admin') }}" class="site-admin-link"
        ><i class="fa-solid fa-shield-halved"></i>Site Admin Login</a
      >
      {% endif %}
    </div>
  </div>
</div>

<!-- Professional JavaScript -->
<script>
  document.addEventListener("DOMContentLoaded", function () {
    console.log("Professional login system initialized");

    // Professional tab switching
    const tabButtons = document.querySelectorAll(".login-tab-button");
    const tabContents = document.querySelectorAll(".login-tab-content");

    tabButtons.forEach((button) => {
      button.addEventListener("click", () => {
        // Remove active class from all tabs and content
        tabButtons.forEach((btn) => btn.classList.remove("active"));
        tabContents.forEach((content) => content.classList.remove("active"));

        // Add active class to clicked tab
        button.classList.add("active");

        // Show corresponding content with animation
        const targetId = button.dataset.tabTarget;
        const targetContent = document.querySelector(targetId);
        if (targetContent) {
          targetContent.classList.add("active", "fade-in");
        }
      });
    });

    // Professional form handling
    const userForm = document.getElementById("user-login-form");
    const clubForm = document.getElementById("club-login-form");

    function handleFormSubmit(form, buttonId) {
      if (!form) return;

      form.addEventListener("submit", function (e) {
        const submitBtn = document.getElementById(buttonId);
        if (submitBtn) {
          // Add loading state
          submitBtn.classList.add("btn-loading");
          submitBtn.disabled = true;

          // Re-enable after 5 seconds as fallback
          setTimeout(() => {
            submitBtn.classList.remove("btn-loading");
            submitBtn.disabled = false;
          }, 5000);
        }
      });
    }

    handleFormSubmit(userForm, "user-login-btn");
    handleFormSubmit(clubForm, "club-login-btn");

    // Professional form validation
    function addValidation(formId) {
      const form = document.getElementById(formId);
      if (!form) return;

      const inputs = form.querySelectorAll("input[required]");

      inputs.forEach((input) => {
        // Real-time validation
        input.addEventListener("blur", function () {
          const formGroup = this.closest(".form-group");

          if (this.validity.valid && this.value.trim()) {
            formGroup.classList.remove("has-error");
            formGroup.classList.add("has-success");
          } else {
            formGroup.classList.remove("has-success");
            formGroup.classList.add("has-error");
          }
        });

        // Clear validation on focus
        input.addEventListener("focus", function () {
          const formGroup = this.closest(".form-group");
          formGroup.classList.remove("has-error", "has-success");
        });
      });
    }

    addValidation("user-login-form");
    addValidation("club-login-form");

    // Handle pre-filled league code (if coming from landing page)
    const urlParams = new URLSearchParams(window.location.search);
    const leagueCode = urlParams.get("code");
    if (leagueCode) {
      // Store league code to use after login
      sessionStorage.setItem("pendingLeagueCode", leagueCode);

      // Show a helpful message
      const authCard = document.querySelector(".auth-card");
      const notice = document.createElement("div");
      notice.className = "success-message";
      notice.innerHTML = `
            <i class="fa-solid fa-info-circle"></i>
            Ready to join league with code: <strong>${leagueCode}</strong>
        `;
      authCard.insertBefore(notice, authCard.querySelector(".login-tabs"));
    }

    // Enhanced keyboard navigation
    document.addEventListener("keydown", function (e) {
      // Ctrl/Cmd + Tab to switch between login types
      if ((e.ctrlKey || e.metaKey) && e.key === "Tab") {
        e.preventDefault();
        const activeTab = document.querySelector(".login-tab-button.active");
        const tabs = document.querySelectorAll(".login-tab-button");
        const currentIndex = Array.from(tabs).indexOf(activeTab);
        const nextIndex = (currentIndex + 1) % tabs.length;
        tabs[nextIndex].click();
      }
    });

    // Auto-focus first input
    const activeTabContent = document.querySelector(
      ".login-tab-content.active"
    );
    if (activeTabContent) {
      const firstInput = activeTabContent.querySelector("input");
      if (firstInput) {
        firstInput.focus();
      }
    }

    console.log("Professional login interactions ready");
  });
</script>

<style>
  /* Viewport optimization for login choice */
  .auth-container {
    min-height: 100vh;
    max-height: 100vh;
    overflow: hidden;
    padding: 1rem;
    display: flex;
    justify-content: center;
    align-items: center;
  }

  .auth-card {
    padding: 1.75rem 2rem;
    max-width: 420px;
    max-height: calc(100vh - 2rem);
    overflow-y: auto;
    animation: slideUp 0.6s ease-out;
  }

  /* Compact header */
  .auth-card h1 {
    font-size: 1.75rem;
    margin-bottom: 0.5rem;
  }

  .auth-card .subtitle {
    font-size: 1rem;
    margin-bottom: 1.25rem;
  }

  /* Compact logo */
  .auth-logo {
    margin-bottom: 1rem;
  }

  .auth-logo img {
    max-width: 100px;
  }

  /* Compact login tabs */
  .login-tabs {
    margin-bottom: 1.25rem;
  }

  .login-tab-button {
    padding: 0.875rem 1.25rem;
    font-size: 0.9rem;
    gap: 0.5rem;
  }

  .login-tab-button i {
    font-size: 1rem;
  }

  /* Compact form elements */
  .login-tab-content form {
    gap: 1rem;
  }

  .form-group {
    margin-bottom: 0.75rem;
  }

  .auth-card label {
    margin-bottom: 0.5rem;
    font-size: 0.85rem;
  }

  .auth-card input {
    padding: 0.875rem 1rem;
    font-size: 0.95rem;
  }

  .auth-card .btn {
    padding: 0.875rem 1.5rem;
    font-size: 0.95rem;
    min-height: 46px;
  }

  /* Compact auth links */
  .auth-links {
    margin-top: 1rem;
    font-size: 0.9rem;
  }

  .auth-links p {
    margin: 0.5rem 0;
  }

  .site-admin-link {
    font-size: 0.8rem;
    margin-top: 1rem;
  }

  /* Compact error/success messages */
  .error-message,
  .success-message {
    padding: 0.625rem 0.875rem;
    margin-top: 0.75rem;
    font-size: 0.85rem;
  }

  .error-message::before,
  .success-message::before {
    font-size: 0.9rem;
  }

  /* Professional animations */
  @keyframes slideUp {
    from {
      opacity: 0;
      transform: translateY(30px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* Professional loading button animation */
  .btn-loading {
    position: relative;
    color: transparent !important;
  }

  .btn-loading::after {
    content: "";
    position: absolute;
    top: 50%;
    left: 50%;
    width: 18px;
    height: 18px;
    margin: -9px 0 0 -9px;
    border: 2px solid transparent;
    border-top: 2px solid white;
    border-radius: 50%;
    animation: spin 1s linear infinite;
  }

  @keyframes spin {
    0% {
      transform: rotate(0deg);
    }
    100% {
      transform: rotate(360deg);
    }
  }

  /* Professional focus states */
  .form-group input:focus {
    transform: translateY(-1px);
    box-shadow: 0 0 0 4px rgba(0, 106, 78, 0.1), 0 4px 12px rgba(0, 0, 0, 0.1);
  }

  /* Professional hover effects */
  .login-tab-button:hover {
    transform: translateY(-1px);
  }

  .btn:hover:not(:disabled) {
    transform: translateY(-2px);
  }

  /* Professional error and success states */
  .has-error input {
    border-color: #dc2626 !important;
    background: #fef2f2 !important;
  }

  .has-success input {
    border-color: #16a34a !important;
    background: #f0fdf4 !important;
  }

  /* Remember Me Styling */
  .remember-me-group {
    margin-bottom: 1.25rem;
  }

  .remember-me-label {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    cursor: pointer;
    font-weight: 500;
    font-size: 0.9rem;
    color: var(--text-secondary);
    margin: 0;
    text-transform: none;
    letter-spacing: normal;
  }

  .remember-me-label input[type="checkbox"] {
    width: 18px;
    height: 18px;
    cursor: pointer;
    accent-color: var(--primary-green);
    margin: 0;
  }

  .remember-me-label:hover {
    color: var(--text-primary);
  }

  .remember-me-label span {
    user-select: none;
  }

  /* Mobile responsiveness */
  @media (max-width: 768px) {
    .auth-container {
      padding: 0.5rem;
      max-height: none;
      overflow: visible;
    }

    .auth-card {
      padding: 1.5rem;
      max-height: none;
    }

    .auth-card h1 {
      font-size: 1.5rem;
    }

    .login-tab-button {
      padding: 0.75rem 1rem;
      font-size: 0.85rem;
    }
  }

  @media (max-width: 480px) {
    .auth-container {
      padding: 0.25rem;
    }

    .auth-card {
      padding: 1.25rem;
    }

    .auth-logo img {
      max-width: 80px;
    }

    .auth-card h1 {
      font-size: 1.4rem;
    }

    .auth-card .subtitle {
      font-size: 0.9rem;
    }
  }

  /* Height-specific optimizations */
  @media (max-height: 700px) {
    .auth-card {
      padding: 1.5rem 2rem;
    }

    .auth-logo {
      margin-bottom: 0.75rem;
    }

    .auth-logo img {
      max-width: 90px;
    }

    .auth-card h1 {
      font-size: 1.6rem;
      margin-bottom: 0.375rem;
    }

    .auth-card .subtitle {
      margin-bottom: 1rem;
    }

    .login-tabs {
      margin-bottom: 1rem;
    }

    .auth-links {
      margin-top: 0.75rem;
    }
  }

  @media (max-height: 600px) {
    .auth-card {
      padding: 1.25rem 1.75rem;
    }

    .auth-logo img {
      max-width: 80px;
    }

    .auth-card h1 {
      font-size: 1.5rem;
    }

    .form-group {
      margin-bottom: 0.5rem;
    }

    .login-tab-content form {
      gap: 0.75rem;
    }
  }
</style>

{% endblock %}
