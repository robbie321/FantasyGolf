{% extends 'base.html' %} {% block content %}
<h1>League Details: {{ league.name }}</h1>

<div class="league-details-container">
  <p><strong>League Code:</strong> {{ league.league_code }}</p>
  <p><strong>Entry Fee:</strong> €{{ "%.2f" | format(league.entry_fee) }}</p>

  <h3>Prize Details:</h3>
  {% if league.prize_details %}
  <p>{{ league.prize_details }}</p>
  {% else %}
  <p>No specific prize details provided yet.</p>
  {% endif %}

  <h3>Rules:</h3>
  {% if league.rules %}
  <p>{{ league.rules }}</p>
  {% else %}
  <p>No specific rules provided yet.</p>
  {% endif %}

  <h3>Tie-Breaker Question:</h3>
  <p>{{ league.tie_breaker_question }}</p>

  <p class="warning-message">
    By proceeding, you confirm your understanding of the league rules and agree
    to pay the entry fee of €{{ "%.2f" | format(league.entry_fee) }}.
  </p>

  {# NEW: Stripe Payment Button #}
  <button id="checkout-button" class="button primary">Pay with Stripe</button>
  <a href="{{ url_for('main.user_dashboard') }}" class="button secondary"
    >Cancel and Go Back</a
  >
</div>

<!-- <style>
        .league-details-container {
            background-color: #ffffff;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
            max-width: 700px;
            margin: 20px auto;
        }
        .league-details-container h3 {
            margin-top: 25px;
            margin-bottom: 10px;
            color: #34495e;
            text-align: left;
            border-bottom: 1px solid #eee;
            padding-bottom: 5px;
        }
        .league-details-container p {
            margin-bottom: 10px;
        }
        .warning-message {
            background-color: #fff3cd;
            color: #856404;
            border: 1px solid #ffeeba;
            padding: 15px;
            border-radius: 5px;
            margin-top: 20px;
            font-weight: bold;
        }
        .league-details-container form,
        .league-details-container .button-group {
            background: none;
            box-shadow: none;
            padding: 0;
            margin-top: 20px;
            display: flex;
            gap: 10px;
            justify-content: center;
        }
        .league-details-container .button {
            display: inline-block;
            width: auto;
            margin: 0;
        }
    </style> -->

{# NEW: Stripe.js and Checkout Logic #}
<script src="https://js.stripe.com/v3/"></script>
<script>
  const stripe = Stripe("{{ stripe_public_key }}");
  const checkoutButton = document.getElementById("checkout-button");

  checkoutButton.addEventListener("click", function () {
    fetch(
      "{{ url_for('league.create_checkout_session', league_id=league.id) }}",
      {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
      }
    )
      .then(function (response) {
        if (response.redirected) {
          window.location.href = response.url;
        } else {
          console.error("Failed to initiate checkout session:", response);
          alert("Could not initiate payment. Please try again.");
        }
      })
      .catch(function (error) {
        console.error("Error:", error);
        alert("An error occurred during payment initiation. Please try again.");
      });
  });
</script>
{% endblock %}
