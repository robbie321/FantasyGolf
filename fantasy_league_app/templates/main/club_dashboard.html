{% extends 'base.html' %} {% block head %}
<!-- Enhanced fonts for professional look -->
<link rel="preconnect" href="https://fonts.googleapis.com" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
<link
  href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap"
  rel="stylesheet"
/>

<!-- Quill Rich Text Editor -->
<link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
<script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>

<!-- Club dashboard data for JavaScript -->
<script>
  window.clubData = {{ club_data_for_js|tojson }};
  window.clubLeagues = {{ club_leagues_for_js|tojson }};
  window.clubRevenue = {{ club_revenue|tojson }};
  const serverTimeNow = new Date('{{ now.isoformat() }}Z');
</script>
{% endblock %} {% block content %}
<div class="dashboard-wrapper">
  <!-- Professional Sidebar -->
  {% include 'main/_shared_side_navbar.html' with context %}

  <!-- Mobile Navigation -->
  {% include 'main/_shared_bottom_navbar.html' with context %}

  <!-- Main Dashboard Content -->
  <main class="dashboard-content">
    <!-- Professional Club Hero Section -->
    <header class="dashboard-hero">
      <div class="user-info">
        <div class="avatar">{{ current_user.club_name[0]|upper }}</div>

        <div class="club-details">
          <div>
            <h1>Welcome back, {{ current_user.club_name.split(' ')[0] }}!</h1>
            <p class="subtitle">
              Manage your leagues and grow your club's revenue.
            </p>
          </div>

          <a href="{{ url_for('league.create_league') }}" class="nav-item-club">
            <i class="fa-solid fa-plus"></i>
            Create League
          </a>
        </div>
      </div>

      <!-- Professional Club Stats Grid -->
      <div class="stats-grid">
        <div class="stat-card">
          <span class="value">{{ active_leagues_count }}</span>
          <span class="label">Active Leagues</span>
        </div>
        <div class="stat-card">
          <span class="value">â‚¬{{ "%.2f"|format(club_revenue) }}</span>
          <span class="label">Total Revenue</span>
        </div>
        <div class="stat-card">
          <span class="value">{{ total_entries_count }}</span>
          <span class="label">Total Entries</span>
        </div>
      </div>
    </header>

    <!-- Main Content Container -->
    <div class="content-container">
      <!-- Dashboard Section - Club Leagues -->
      <section id="dashboard-section" class="page-section">
        <div class="leagues-section">
          <h2>
            <i class="fa-solid fa-building"></i>
            My Leagues
          </h2>

          <!-- Professional Tab Navigation -->
          <div class="tabs-container">
            <div class="tabs capsule-tabs" id="club-league-tabs">
              <button class="tab-button active" data-status="Live">
                <i class="fa-solid fa-circle"></i>
                Live
              </button>
              <button class="tab-button" data-status="Upcoming">
                <i class="fa-solid fa-clock"></i>
                Upcoming
              </button>
              <button class="tab-button" data-status="Past">
                <i class="fa-solid fa-flag-checkered"></i>
                Past
              </button>
            </div>
          </div>

          <!-- Search and Filter Controls -->
          <div class="league-controls">
            <div class="search-filter-row">
              <div class="search-box">
                <i class="fa-solid fa-search"></i>
                <input
                  type="text"
                  id="league-search"
                  placeholder="Search leagues by name or code..."
                  class="search-input"
                />
              </div>

              <div class="filter-group">
                <select id="tour-filter" class="filter-select">
                  <option value="">All Tours</option>
                  <option value="PGA">PGA Tour</option>
                  <option value="LPGA">LPGA</option>
                  <option value="DP">DP World Tour</option>
                  <option value="LIV">LIV Golf</option>
                </select>

                <select id="sort-select" class="filter-select">
                  <option value="date-desc">Newest First</option>
                  <option value="date-asc">Oldest First</option>
                  <option value="entries-desc">Most Participants</option>
                  <option value="entries-asc">Least Participants</option>
                  <option value="name-asc">Name A-Z</option>
                  <option value="name-desc">Name Z-A</option>
                </select>

                <button id="clear-filters" class="btn btn-outline btn-sm" style="display: none;">
                  <i class="fa-solid fa-times"></i>
                  Clear
                </button>
              </div>
            </div>

            <div class="bulk-actions-row" id="bulk-actions" style="display: none;">
              <div class="bulk-actions-info">
                <input type="checkbox" id="select-all" />
                <label for="select-all">
                  <span id="selected-count">0</span> selected
                </label>
              </div>
              <div class="bulk-actions-buttons">
                <button class="btn btn-outline btn-sm" id="bulk-export">
                  <i class="fa-solid fa-download"></i>
                  Export Selected
                </button>
                <button class="btn btn-primary btn-sm" id="bulk-communicate">
                  <i class="fa-solid fa-envelope"></i>
                  Send Message
                </button>
              </div>
            </div>
          </div>

          <!-- Professional Club Leagues Table -->
          <div class="club-leagues-container">
            <div class="club-leagues-table-wrapper">
              <table class="club-leagues-table" id="club-leagues-table">
                <thead>
                  <tr>
                    <th style="width: 40px;">
                      <input type="checkbox" class="league-checkbox-header" style="display: none;" />
                    </th>
                    <th>
                      <i class="fa-solid fa-trophy"></i>
                      League Details
                    </th>
                    <th class="text-center">
                      <i class="fa-solid fa-users"></i>
                      Entries
                    </th>
                    <th class="text-center">
                      <i class="fa-solid fa-chart-line"></i>
                      Status
                    </th>
                    <th class="text-center">
                      <i class="fa-solid fa-cog"></i>
                      Actions
                    </th>
                  </tr>
                </thead>
                <tbody>
                  {% for league in club_leagues %}
                  <tr class="league-row"
                      data-status="{{ league['status'] }}"
                      data-league-id="{{ league['id'] }}"
                      data-league-name="{{ league['name'] }}"
                      data-league-tour="{{ league.get('tour', 'PGA') }}"
                      data-league-entries="{{ league['entries'] }}"
                      data-league-date="{{ league.get('start_date', '') }}">
                    <td style="width: 40px;">
                      <input type="checkbox" class="league-checkbox" value="{{ league['id'] }}" />
                    </td>
                    <td class="league-details-cell">
                      <div class="league-info">
                        <h4 class="league-title">{{ league['name'] }}</h4>
                        <div class="league-meta">
                          <span class="league-code">
                            <i class="fa-solid fa-key"></i>
                            Code: {{ league['league_code'] }}
                          </span>
                          <span class="tour-indicator">
                            <i class="fa-solid fa-golf-ball"></i>
                            {{ league.get('tour', 'PGA').upper() }}
                          </span>
                        </div>
                      </div>
                    </td>

                    <td class="text-center entries-cell">
                      <div class="entries-display">
                        <span class="entries-count"
                          >{{ league['entries'] }}</span
                        >
                        <span class="entries-label">participants</span>
                      </div>
                    </td>

                    <td class="text-center status-cell">
                      <span
                        class="status-badge status-{{ league['status']|lower }}"
                      >
                        {% if league['status'] == 'Live' %}
                        <i class="fa-solid fa-circle"></i>
                        {% elif league['status'] == 'Upcoming' %}
                        <i class="fa-solid fa-clock"></i>
                        {% else %}
                        <i class="fa-solid fa-flag-checkered"></i>
                        {% endif %} {{ league['status'] }}
                      </span>
                    </td>

                    <td class="actions-cell">
                      <div class="action-buttons">
                        <!-- View Button (always available) -->
                        <a
                          href="{{ url_for('league.club_league_view', league_id=league['id']) }}"
                          class="btn btn-outline btn-sm"
                          title="View League"
                        >
                          <i class="fa-solid fa-eye"></i>
                          View
                        </a>

                        {% set league_start_date = league.get('start_date') %}
                        {% if league_start_date and not
                        league.get('is_finalized', false) and league_start_date
                        > now.isoformat() %}

                        <!-- Share/Copy Section for upcoming leagues -->
                        <div class="share-section">
                          {% if league['league_code'] %}
                          <div class="share-item">
                            <label class="share-label">Access Code</label>
                            <div class="copy-group">
                              <input
                                type="text"
                                class="copy-input"
                                value="{{ league['league_code'] }}"
                                readonly
                                id="access-code-{{ league['id'] }}"
                              />
                              <button
                                class="btn btn-secondary btn-sm copy-btn"
                                data-target="#access-code-{{ league['id'] }}"
                                title="Copy Access Code"
                              >
                                <i class="fa-solid fa-copy"></i>
                              </button>
                            </div>
                          </div>
                          {% else %}
                          <div class="share-item">
                            <label class="share-label">Share Link</label>
                            <div class="copy-group">
                              <input
                                type="text"
                                class="copy-input"
                                value="{{ url_for('league.view_league', league_id=league['id'], _external=True) }}"
                                readonly
                                id="share-link-{{ league['id'] }}"
                              />
                              <button
                                class="btn btn-secondary btn-sm copy-btn"
                                data-target="#share-link-{{ league['id'] }}"
                                title="Copy Share Link"
                              >
                                <i class="fa-solid fa-copy"></i>
                              </button>
                            </div>
                          </div>
                          {% endif %}
                        </div>

                        <!-- Edit Button -->
                        <a
                          href="{{ url_for('league.edit_league', league_id=league['id']) }}"
                          class="btn btn-primary btn-sm"
                          title="Edit League"
                        >
                          <i class="fa-solid fa-edit"></i>
                          Edit
                        </a>

                        <!-- Cancel Button -->
                        <form
                          action="{{ url_for('league.cancel_league', league_id=league['id']) }}"
                          method="POST"
                          style="display: inline"
                          onsubmit="return confirm('Are you sure you want to cancel this league? All entry fees will be refunded and this action cannot be undone.');"
                        >
                          <input
                            type="hidden"
                            name="csrf_token"
                            value="{{ csrf_token() }}"
                          />
                          <button
                            type="submit"
                            class="btn btn-danger btn-sm"
                            title="Cancel League"
                          >
                            <i class="fa-solid fa-times"></i>
                            Cancel
                          </button>
                        </form>
                        {% endif %}
                      </div>
                    </td>
                  </tr>
                  {% else %}
                  <tr class="empty-leagues-row">
                    <td colspan="4">
                      <div class="empty-leagues-content">
                        <i class="fa-solid fa-plus-circle"></i>
                        <h4>No leagues created yet</h4>
                        <p>
                          Start by creating your first league to engage your
                          club members.
                        </p>
                        <a
                          href="{{ url_for('league.create_league') }}"
                          class="btn btn-primary"
                        >
                          <i class="fa-solid fa-plus"></i>
                          Create Your First League
                        </a>
                      </div>
                    </td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </section>

      <!-- Templates Section -->
      <section id="templates-section" class="page-section hidden">
        <header class="dashboard-header">
          <div>
            <h1>
              <i class="fa-solid fa-layer-group"></i>
              League Templates
            </h1>
            <p class="subtitle">
              Create and manage reusable league configurations
            </p>
          </div>
          <button class="btn btn-primary" onclick="openTemplateModal()">
            <i class="fa-solid fa-plus"></i>
            Create Template
          </button>
        </header>

        <div class="templates-grid" id="templates-grid">
          <!-- Templates will be loaded here -->
        </div>

        <div id="templates-empty" class="empty-state" style="display: none;">
          <i class="fa-solid fa-layer-group"></i>
          <h3>No Templates Yet</h3>
          <p>Create your first league template to speed up league creation.</p>
          <button class="btn btn-primary" onclick="openTemplateModal()">
            <i class="fa-solid fa-plus"></i>
            Create Your First Template
          </button>
        </div>
      </section>

      <!-- Wallet Section -->
      <section id="wallet-section" class="page-section hidden">
        <header class="dashboard-header">
          <div>
            <h1>
              <i class="fa-solid fa-wallet"></i>
              Wallet & Payments
            </h1>
            <p class="subtitle">
              Manage your payment details and revenue tracking
            </p>
          </div>
        </header>

        <div class="wallet-grid">
          <!-- Payment Status Card -->
          <div class="wallet-card">
            <div class="wallet-card-header">
              <h3>
                <i class="fa-solid fa-credit-card"></i>
                Payment Account Status
              </h3>
            </div>
            <div class="wallet-card-body">
              {% if not current_user.stripe_account_id %}
              <div class="alert warning">
                <i class="fa-solid fa-triangle-exclamation"></i>
                <div>
                  <strong>Setup Required</strong>
                  <span
                    >Connect your payment account to receive league
                    revenue.</span
                  >
                </div>
              </div>
              {% else %}
              <div class="alert success">
                <i class="fa-regular fa-circle-check"></i>
                <div>
                  <strong>Setup Complete</strong>
                  <span>Stripe account connected and ready.</span>
                </div>
              </div>
              {% endif %}

              <h5>Why connect Stripe?</h5>
              <ul class="feature-list">
                <li>
                  <i class="fa-solid fa-shield-halved"></i> Secure, encrypted
                  payment processing
                </li>
                <li>
                  <i class="fa-solid fa-bolt"></i> Fast revenue deposits to your
                  account
                </li>
                <li>
                  <i class="fa-solid fa-file-invoice"></i> Automatic financial
                  reporting
                </li>
                <li>
                  <i class="fa-solid fa-lock"></i> 24/7 fraud protection and
                  monitoring
                </li>
              </ul>

              <form
                action="{{ url_for('main.onboard_stripe') }}"
                method="POST"
                class="stripe-connect-form"
              >
                <input
                  type="hidden"
                  name="csrf_token"
                  value="{{ csrf_token() }}"
                />
                <button type="submit" class="btn btn-primary btn-lg">
                  <i class="fa-brands fa-stripe"></i>
                  {% if current_user.stripe_account_id %} Manage Stripe Account
                  {% else %} Connect Stripe Account {% endif %}
                </button>
              </form>
            </div>
          </div>

          <!-- Revenue Overview Card -->
          <div class="wallet-card">
            <div class="wallet-card-header">
              <h3>
                <i class="fa-solid fa-chart-pie"></i>
                Revenue Overview
              </h3>
            </div>
            <div class="wallet-card-body">
              <div class="revenue-stats">
                <div class="revenue-stat">
                  <div class="revenue-stat-icon">
                    <i class="fa-solid fa-euro-sign"></i>
                  </div>
                  <div class="revenue-stat-info">
                    <span class="revenue-stat-value"
                      >â‚¬{{ "%.2f"|format(club_revenue) }}</span
                    >
                    <span class="revenue-stat-label">Total Revenue</span>
                  </div>
                </div>

                <div class="revenue-stat">
                  <div class="revenue-stat-icon">
                    <i class="fa-solid fa-trophy"></i>
                  </div>
                  <div class="revenue-stat-info">
                    <span class="revenue-stat-value"
                      >{{ active_leagues_count + (club_leagues|length -
                      active_leagues_count) }}</span
                    >
                    <span class="revenue-stat-label">Total Leagues</span>
                  </div>
                </div>

                <div class="revenue-stat">
                  <div class="revenue-stat-icon">
                    <i class="fa-solid fa-users"></i>
                  </div>
                  <div class="revenue-stat-info">
                    <span class="revenue-stat-value"
                      >{{ total_entries_count }}</span
                    >
                    <span class="revenue-stat-label">Total Participants</span>
                  </div>
                </div>
              </div>

              <div class="revenue-info">
                <h5>Revenue Model</h5>
                <p>
                  Your club keeps 100% of entry fees, minus a small platform fee
                  of â‚¬2.50 per participant to cover hosting and support costs.
                </p>

                <div class="revenue-example">
                  <strong>Example:</strong> 50 participants Ã— â‚¬10 entry = â‚¬500
                  total, â‚¬375 for your club
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Include Shared Dashboard Sections -->
      {% include 'main/_shared_dashboard_sections.html' with context %}
    </div>
  </main>

  <!-- Communication Modal -->
  <div id="communication-modal" class="modal-overlay" style="display: none;">
    <div class="modal-content">
      <div class="modal-header">
        <h2>
          <i class="fa-solid fa-envelope"></i>
          Send Message to Participants
        </h2>
        <button class="modal-close" onclick="closeCommunicationModal()">
          <i class="fa-solid fa-times"></i>
        </button>
      </div>

      <div class="modal-body">
        <div class="alert info">
          <i class="fa-solid fa-info-circle"></i>
          <div>
            <strong>Messaging <span id="recipient-count">0</span> league(s)</strong>
            <span>All participants in selected leagues will receive this message via email.</span>
          </div>
        </div>

        <form id="communication-form" action="{{ url_for('main.send_league_message') }}" method="POST">
          <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
          <input type="hidden" name="league_ids" id="league-ids-input" />

          <div class="form-group">
            <label for="message-template">
              <i class="fa-solid fa-file-lines"></i>
              Message Template (Optional)
            </label>
            <select id="message-template" class="form-control">
              <option value="">Custom Message</option>
              <option value="welcome">Welcome Message</option>
              <option value="reminder">Tournament Reminder</option>
              <option value="update">League Update</option>
            </select>
            <small class="form-text">Choose a template or write your own message. Use {{league_name}}, {{participant_name}}, {{club_name}}, etc.</small>
          </div>

          <div class="form-group">
            <label for="message-subject">
              <i class="fa-solid fa-heading"></i>
              Subject *
            </label>
            <input
              type="text"
              id="message-subject"
              name="subject"
              class="form-control"
              placeholder="Enter email subject..."
              required
            />
          </div>

          <div class="form-group">
            <label for="message-body">
              <i class="fa-solid fa-align-left"></i>
              Message *
            </label>
            <textarea
              id="message-body"
              name="message"
              class="form-control"
              rows="8"
              placeholder="Enter your message..."
              required
            ></textarea>
            <small class="form-text">Available placeholders: {{league_name}}, {{participant_name}}, {{club_name}}, {{league_code}}, {{start_date}}</small>
          </div>

          <div class="modal-footer">
            <button type="button" class="btn btn-outline" onclick="closeCommunicationModal()">
              Cancel
            </button>
            <button type="submit" class="btn btn-primary">
              <i class="fa-solid fa-paper-plane"></i>
              Send Messages
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Template Modal -->
  <div id="template-modal" class="modal-overlay" style="display: none;">
    <div class="modal-content modal-large">
      <div class="modal-header">
        <h2>
          <i class="fa-solid fa-layer-group"></i>
          <span id="template-modal-title">Create League Template</span>
        </h2>
        <button class="modal-close" onclick="closeTemplateModal()">
          <i class="fa-solid fa-times"></i>
        </button>
      </div>

      <div class="modal-body">
        <form id="template-form" action="{{ url_for('main.save_template') }}" method="POST">
          <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
          <input type="hidden" name="template_id" id="template-id-input" value="" />

          <div class="form-row">
            <div class="form-group">
              <label for="template-name">
                <i class="fa-solid fa-tag"></i>
                Template Name *
              </label>
              <input
                type="text"
                id="template-name"
                name="name"
                class="form-control"
                placeholder="e.g., Standard PGA Tournament"
                required
              />
            </div>
          </div>

          <div class="form-group">
            <label for="template-description">
              <i class="fa-solid fa-align-left"></i>
              Description
            </label>
            <textarea
              id="template-description"
              name="description"
              class="form-control"
              rows="2"
              placeholder="Optional description for this template..."
            ></textarea>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="template-entry-fee">
                <i class="fa-solid fa-euro-sign"></i>
                Entry Fee (â‚¬) *
              </label>
              <input
                type="number"
                id="template-entry-fee"
                name="entry_fee"
                class="form-control"
                min="0"
                step="0.01"
                value="10.00"
                required
              />
            </div>

            <div class="form-group">
              <label for="template-max-entries">
                <i class="fa-solid fa-users"></i>
                Max Entries
              </label>
              <input
                type="number"
                id="template-max-entries"
                name="max_entries"
                class="form-control"
                min="1"
                placeholder="Leave empty for unlimited"
              />
            </div>
          </div>

          <div class="form-group">
            <label for="template-prize-details">
              <i class="fa-solid fa-trophy"></i>
              Prize Details
            </label>
            <div id="prize-details-editor" style="height: 150px; background: white; border: 1px solid #ddd; border-radius: 4px;"></div>
            <input type="hidden" id="template-prize-details" name="prize_details" />
            <small class="form-text">Add details about prizes, vouchers, pro shop credits, etc.</small>
          </div>

          <div class="form-group">
            <label for="template-rules">
              <i class="fa-solid fa-gavel"></i>
              League Rules
            </label>
            <div id="rules-editor" style="height: 200px; background: white; border: 1px solid #ddd; border-radius: 4px;"></div>
            <input type="hidden" id="template-rules" name="rules" />
            <small class="form-text">Format your league rules with bullets, bold, italics, etc.</small>
          </div>

          <div class="modal-footer">
            <button type="button" class="btn btn-outline" onclick="closeTemplateModal()">
              Cancel
            </button>
            <button type="submit" class="btn btn-primary">
              <i class="fa-solid fa-save"></i>
              Save Template
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- Professional JavaScript -->
<script>
  // Global variables for template management
  let currentTemplateId = null;
  let rulesEditor = null;
  let prizeDetailsEditor = null;

  // Global template functions (must be outside DOMContentLoaded for onclick handlers)
  function openTemplateModal(templateId = null) {
      console.log('openTemplateModal called with templateId:', templateId);
      const modal = document.getElementById('template-modal');
      const title = document.getElementById('template-modal-title');
      const form = document.getElementById('template-form');

      console.log('Modal element:', modal);
      console.log('Title element:', title);
      console.log('Form element:', form);

      currentTemplateId = templateId;

      if (templateId) {
          title.textContent = 'Edit League Template';
          loadTemplateData(templateId);
      } else {
          title.textContent = 'Create League Template';
          form.reset();
          document.getElementById('template-id-input').value = '';
          if (rulesEditor) {
              rulesEditor.setContents([]);
          }
          if (prizeDetailsEditor) {
              prizeDetailsEditor.setContents([]);
          }
      }

      // Initialize Quill editors if not already done
      if (!prizeDetailsEditor) {
          prizeDetailsEditor = new Quill('#prize-details-editor', {
              theme: 'snow',
              modules: {
                  toolbar: [
                      ['bold', 'italic', 'underline'],
                      [{ 'list': 'ordered'}, { 'list': 'bullet' }],
                      ['clean']
                  ]
              },
              placeholder: 'Enter prize details here...'
          });
      }

      if (!rulesEditor) {
          rulesEditor = new Quill('#rules-editor', {
              theme: 'snow',
              modules: {
                  toolbar: [
                      ['bold', 'italic', 'underline'],
                      [{ 'list': 'ordered'}, { 'list': 'bullet' }],
                      ['clean']
                  ]
              },
              placeholder: 'Enter league rules here...'
          });
      }

      modal.style.display = 'flex';
      modal.style.visibility = 'visible';
      modal.style.opacity = '1';
      document.body.style.overflow = 'hidden';

      console.log('Modal should now be visible');
      console.log('Modal computed display:', window.getComputedStyle(modal).display);
  }

  function closeTemplateModal() {
      const modal = document.getElementById('template-modal');
      modal.style.display = 'none';
      document.body.style.overflow = 'auto';
      currentTemplateId = null;
  }

  async function loadTemplateData(templateId) {
      try {
          const response = await fetch(`/api/templates/${templateId}`);
          const template = await response.json();

          document.getElementById('template-id-input').value = template.id;
          document.getElementById('template-name').value = template.name;
          document.getElementById('template-description').value = template.description || '';
          document.getElementById('template-entry-fee').value = template.entry_fee;
          document.getElementById('template-max-entries').value = template.max_entries || '';

          // Load prize details into Quill editor
          if (prizeDetailsEditor && template.prize_details) {
              prizeDetailsEditor.root.innerHTML = template.prize_details;
          }

          // Load rules into Quill editor
          if (rulesEditor && template.rules) {
              rulesEditor.root.innerHTML = template.rules;
          }
      } catch (error) {
          console.error('Failed to load template data:', error);
      }
  }

  async function editTemplate(templateId) {
      openTemplateModal(templateId);
  }

  async function deleteTemplate(templateId, templateName) {
      if (!confirm(`Are you sure you want to delete "${templateName}"? This cannot be undone.`)) {
          return;
      }

      try {
          const response = await fetch(`/api/templates/${templateId}`, {
              method: 'DELETE',
              headers: {
                  'Content-Type': 'application/json',
                  'X-CSRFToken': '{{ csrf_token() }}'
              }
          });

          if (response.ok) {
              loadTemplates();
              alert('Template deleted successfully!');
          } else {
              alert('Failed to delete template. Please try again.');
          }
      } catch (error) {
          console.error('Failed to delete template:', error);
          alert('An error occurred. Please try again.');
      }
  }

  async function loadTemplates() {
      try {
          const response = await fetch('/api/templates');
          const templates = await response.json();

          const grid = document.getElementById('templates-grid');
          const emptyState = document.getElementById('templates-empty');

          if (templates.length === 0) {
              grid.style.display = 'none';
              emptyState.style.display = 'flex';
          } else {
              grid.style.display = 'grid';
              emptyState.style.display = 'none';

              grid.innerHTML = templates.map(template => `
                  <div class="template-card">
                      <div class="template-card-header">
                          <h3>${template.name}</h3>
                      </div>
                      <div class="template-card-body">
                          ${template.description ? `<p class="template-description">${template.description}</p>` : ''}
                          <div class="template-stats">
                              <div class="template-stat">
                                  <i class="fa-solid fa-euro-sign"></i>
                                  <span>â‚¬${template.entry_fee}</span>
                              </div>
                              <div class="template-stat">
                                  <i class="fa-solid fa-users"></i>
                                  <span>${template.max_entries ? template.max_entries + ' entries' : 'Unlimited'}</span>
                              </div>
                              <div class="template-stat">
                                  <i class="fa-solid fa-clock"></i>
                                  <span>Used ${template.times_used}x</span>
                              </div>
                          </div>
                      </div>
                      <div class="template-card-actions">
                          <button class="btn btn-outline btn-sm" onclick="editTemplate(${template.id})">
                              <i class="fa-solid fa-edit"></i>
                              Edit
                          </button>
                          <button class="btn btn-danger btn-sm" onclick="deleteTemplate(${template.id}, '${template.name}')">
                              <i class="fa-solid fa-trash"></i>
                              Delete
                          </button>
                      </div>
                  </div>
              `).join('');
          }
      } catch (error) {
          console.error('Failed to load templates:', error);
      }
  }

  document.addEventListener("DOMContentLoaded", function() {
      console.log("Professional Club Dashboard Initialized");

      // Tab functionality for league filtering
      const tabButtons = document.querySelectorAll('#club-league-tabs .tab-button');
      const leagueRows = document.querySelectorAll('.league-row');
      const emptyRow = document.querySelector('.empty-leagues-row');

      // Search, filter, and sort elements
      const searchInput = document.getElementById('league-search');
      const tourFilter = document.getElementById('tour-filter');
      const sortSelect = document.getElementById('sort-select');
      const clearFiltersBtn = document.getElementById('clear-filters');

      // Bulk actions elements
      const selectAllCheckbox = document.getElementById('select-all');
      const bulkActionsRow = document.getElementById('bulk-actions');
      const selectedCountSpan = document.getElementById('selected-count');
      const leagueCheckboxes = document.querySelectorAll('.league-checkbox');
      const bulkExportBtn = document.getElementById('bulk-export');
      const bulkCommunicateBtn = document.getElementById('bulk-communicate');

      let currentFilters = {
          status: 'Live',
          search: '',
          tour: '',
          sort: 'date-desc'
      };

      // Apply all filters and sorting
      function applyFilters() {
          let visibleRows = [];

          leagueRows.forEach(row => {
              const status = row.dataset.status;
              const name = row.dataset.leagueName.toLowerCase();
              const tour = row.dataset.leagueTour.toUpperCase();
              const searchTerm = currentFilters.search.toLowerCase();

              // Check if row matches all filters
              const matchesStatus = status === currentFilters.status;
              const matchesSearch = !searchTerm || name.includes(searchTerm) ||
                                   row.querySelector('.league-code')?.textContent.toLowerCase().includes(searchTerm);
              const matchesTour = !currentFilters.tour || tour === currentFilters.tour;

              if (matchesStatus && matchesSearch && matchesTour) {
                  visibleRows.push(row);
              } else {
                  row.style.display = 'none';
              }
          });

          // Sort visible rows
          sortRows(visibleRows);

          // Show/hide rows
          visibleRows.forEach(row => row.style.display = '');

          // Update empty state
          updateEmptyState(visibleRows.length);

          // Show/hide clear filters button
          const hasActiveFilters = currentFilters.search || currentFilters.tour || currentFilters.sort !== 'date-desc';
          clearFiltersBtn.style.display = hasActiveFilters ? 'inline-flex' : 'none';
      }

      function sortRows(rows) {
          const tbody = document.querySelector('.club-leagues-table tbody');

          rows.sort((a, b) => {
              const aName = a.dataset.leagueName;
              const bName = b.dataset.leagueName;
              const aEntries = parseInt(a.dataset.leagueEntries) || 0;
              const bEntries = parseInt(b.dataset.leagueEntries) || 0;
              const aDate = new Date(a.dataset.leagueDate || 0);
              const bDate = new Date(b.dataset.leagueDate || 0);

              switch(currentFilters.sort) {
                  case 'name-asc':
                      return aName.localeCompare(bName);
                  case 'name-desc':
                      return bName.localeCompare(aName);
                  case 'entries-asc':
                      return aEntries - bEntries;
                  case 'entries-desc':
                      return bEntries - aEntries;
                  case 'date-asc':
                      return aDate - bDate;
                  case 'date-desc':
                  default:
                      return bDate - aDate;
              }
          });

          // Reorder DOM elements
          rows.forEach(row => tbody.appendChild(row));
      }

      function updateEmptyState(visibleCount) {
          if (emptyRow) {
              if (visibleCount === 0 && leagueRows.length > 0) {
                  emptyRow.style.display = '';
                  emptyRow.querySelector('h4').textContent = `No ${currentFilters.status.toLowerCase()} leagues found`;
                  emptyRow.querySelector('p').textContent = 'Try adjusting your filters or search terms.';
              } else if (leagueRows.length === 0) {
                  emptyRow.style.display = '';
              } else {
                  emptyRow.style.display = 'none';
              }
          }
      }

      // Tab click handler
      tabButtons.forEach(button => {
          button.addEventListener('click', () => {
              tabButtons.forEach(btn => btn.classList.remove('active'));
              button.classList.add('active');
              currentFilters.status = button.dataset.status;
              applyFilters();
          });
      });

      // Search handler
      searchInput.addEventListener('input', (e) => {
          currentFilters.search = e.target.value;
          applyFilters();
      });

      // Tour filter handler
      tourFilter.addEventListener('change', (e) => {
          currentFilters.tour = e.target.value;
          applyFilters();
      });

      // Sort handler
      sortSelect.addEventListener('change', (e) => {
          currentFilters.sort = e.target.value;
          applyFilters();
      });

      // Clear filters handler
      clearFiltersBtn.addEventListener('click', () => {
          searchInput.value = '';
          tourFilter.value = '';
          sortSelect.value = 'date-desc';
          currentFilters.search = '';
          currentFilters.tour = '';
          currentFilters.sort = 'date-desc';
          applyFilters();
      });

      // Bulk selection handlers
      selectAllCheckbox.addEventListener('change', (e) => {
          const visibleCheckboxes = Array.from(leagueCheckboxes).filter(cb => {
              return cb.closest('.league-row').style.display !== 'none';
          });

          visibleCheckboxes.forEach(cb => {
              cb.checked = e.target.checked;
          });

          updateBulkActionsUI();
      });

      leagueCheckboxes.forEach(checkbox => {
          checkbox.addEventListener('change', updateBulkActionsUI);
      });

      function updateBulkActionsUI() {
          const checkedBoxes = Array.from(leagueCheckboxes).filter(cb => cb.checked);
          const count = checkedBoxes.length;

          selectedCountSpan.textContent = count;

          if (count > 0) {
              bulkActionsRow.style.display = 'flex';
          } else {
              bulkActionsRow.style.display = 'none';
              selectAllCheckbox.checked = false;
          }
      }

      // Bulk export handler
      bulkExportBtn.addEventListener('click', () => {
          const selectedIds = Array.from(leagueCheckboxes)
              .filter(cb => cb.checked)
              .map(cb => cb.value);

          if (selectedIds.length === 0) return;

          // Create CSV data
          let csv = 'League Name,League Code,Tour,Status,Entries,Start Date\n';

          selectedIds.forEach(id => {
              const row = document.querySelector(`tr[data-league-id="${id}"]`);
              if (row) {
                  const name = row.dataset.leagueName;
                  const code = row.querySelector('.league-code')?.textContent.replace('Code: ', '') || '';
                  const tour = row.dataset.leagueTour;
                  const status = row.dataset.status;
                  const entries = row.dataset.leagueEntries;
                  const date = row.dataset.leagueDate;

                  csv += `"${name}","${code}","${tour}","${status}","${entries}","${date}"\n`;
              }
          });

          // Download CSV
          const blob = new Blob([csv], { type: 'text/csv' });
          const url = window.URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url;
          a.download = `leagues_export_${new Date().toISOString().split('T')[0]}.csv`;
          a.click();
          window.URL.revokeObjectURL(url);

          // Show success message
          alert(`Exported ${selectedIds.length} league(s) successfully!`);
      });

      // Bulk communicate handler - will open modal
      bulkCommunicateBtn.addEventListener('click', () => {
          const selectedIds = Array.from(leagueCheckboxes)
              .filter(cb => cb.checked)
              .map(cb => cb.value);

          if (selectedIds.length === 0) return;

          // Store selected IDs for communication modal
          sessionStorage.setItem('selectedLeagueIds', JSON.stringify(selectedIds));

          // Open communication modal
          openCommunicationModal(selectedIds);
      });

      // Copy functionality
      document.querySelectorAll('.copy-btn').forEach(button => {
          button.addEventListener('click', function() {
              const targetInput = document.querySelector(this.dataset.target);
              if (targetInput) {
                  targetInput.select();
                  targetInput.setSelectionRange(0, 99999); // For mobile devices

                  try {
                      document.execCommand('copy');

                      // Visual feedback
                      const originalHTML = this.innerHTML;
                      this.innerHTML = '<i class="fa-solid fa-check"></i>';
                      this.classList.add('success');

                      setTimeout(() => {
                          this.innerHTML = originalHTML;
                          this.classList.remove('success');
                      }, 2000);
                  } catch (err) {
                      console.error('Failed to copy text: ', err);
                  }
              }
          });
      });

      // Enhanced form handling
      document.querySelectorAll('form').forEach(form => {
          form.addEventListener('submit', function() {
              const submitBtn = form.querySelector('button[type="submit"]');
              if (submitBtn && !submitBtn.classList.contains('btn-danger')) {
                  submitBtn.disabled = true;
                  const originalText = submitBtn.innerHTML;
                  submitBtn.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> Processing...';

                  // Re-enable after 5 seconds as fallback
                  setTimeout(() => {
                      submitBtn.disabled = false;
                      submitBtn.innerHTML = originalText;
                  }, 5000);
              }
          });
      });

      // Communication Modal Functions
      function openCommunicationModal(selectedIds) {
          const modal = document.getElementById('communication-modal');
          if (modal) {
              modal.style.display = 'flex';
              document.body.style.overflow = 'hidden';

              // Update recipient count
              const recipientCount = document.getElementById('recipient-count');
              if (recipientCount) {
                  recipientCount.textContent = selectedIds.length;
              }

              // Set league IDs in hidden input
              const leagueIdsInput = document.getElementById('league-ids-input');
              if (leagueIdsInput) {
                  leagueIdsInput.value = JSON.stringify(selectedIds);
              }
          }
      }

      function closeCommunicationModal() {
          const modal = document.getElementById('communication-modal');
          if (modal) {
              modal.style.display = 'none';
              document.body.style.overflow = 'auto';

              // Reset form
              document.getElementById('message-subject').value = '';
              document.getElementById('message-body').value = '';
              document.getElementById('message-template').value = '';
          }
      }

      // Close modal when clicking outside
      const modal = document.getElementById('communication-modal');
      if (modal) {
          modal.addEventListener('click', (e) => {
              if (e.target === modal) {
                  closeCommunicationModal();
              }
          });
      }

      // Template selection handler
      const templateSelect = document.getElementById('message-template');
      if (templateSelect) {
          templateSelect.addEventListener('change', (e) => {
              const templates = {
                  'welcome': {
                      subject: 'Welcome to {{league_name}}!',
                      body: 'Hi {{participant_name}},\n\nWelcome to {{league_name}}! We\'re excited to have you join us for this tournament.\n\nYour league code is: {{league_code}}\n\nGood luck!\n\n{{club_name}}'
                  },
                  'reminder': {
                      subject: 'Reminder: {{league_name}} starts soon',
                      body: 'Hi {{participant_name}},\n\nThis is a friendly reminder that {{league_name}} starts on {{start_date}}.\n\nMake sure to check your picks before the tournament begins!\n\nBest regards,\n{{club_name}}'
                  },
                  'update': {
                      subject: 'Important Update: {{league_name}}',
                      body: 'Hi {{participant_name}},\n\nWe have an important update regarding {{league_name}}.\n\n[Your message here]\n\nThank you,\n{{club_name}}'
                  }
              };

              const template = templates[e.target.value];
              if (template) {
                  document.getElementById('message-subject').value = template.subject;
                  document.getElementById('message-body').value = template.body;
              }
          });
      }

      // Close modals when clicking outside
      const templateModal = document.getElementById('template-modal');
      if (templateModal) {
          templateModal.addEventListener('click', (e) => {
              if (e.target === templateModal) {
                  closeTemplateModal();
              }
          });
      }

      // Load templates when templates section is shown
      const templatesSection = document.getElementById('templates-section');
      if (templatesSection) {
          const observer = new MutationObserver((mutations) => {
              mutations.forEach((mutation) => {
                  if (mutation.type === 'attributes' && mutation.attributeName === 'class') {
                      if (!templatesSection.classList.contains('hidden')) {
                          loadTemplates();
                      }
                  }
              });
          });

          observer.observe(templatesSection, { attributes: true });
      }

      // Attach event listeners to create template buttons
      document.querySelectorAll('button[onclick*="openTemplateModal"]').forEach(btn => {
          btn.addEventListener('click', function(e) {
              e.preventDefault();
              console.log('Button clicked via event listener');
              openTemplateModal();
          });
      });

      // Handle template form submission
      const templateForm = document.getElementById('template-form');
      if (templateForm) {
          templateForm.addEventListener('submit', function(e) {
              // Get the HTML content from Quill editors and put them in hidden inputs
              if (prizeDetailsEditor) {
                  const prizeHTML = prizeDetailsEditor.root.innerHTML;
                  document.getElementById('template-prize-details').value = prizeHTML;
              }
              if (rulesEditor) {
                  const rulesHTML = rulesEditor.root.innerHTML;
                  document.getElementById('template-rules').value = rulesHTML;
              }
              // Form will submit normally
          });
      }

      // Initialize with Live tab
      const defaultTab = document.querySelector('#club-league-tabs .tab-button[data-status="Live"]');
      if (defaultTab) {
          defaultTab.click();
      }

      console.log("Club dashboard loaded with", {{ club_leagues|length }}, "total leagues");
      console.log("openTemplateModal function defined:", typeof openTemplateModal);
  });
</script>

<style>
  /* Professional Club Dashboard Styles */
  .club-leagues-container {
    background: var(--white);
    border-radius: var(--border-radius-lg);
    overflow: hidden;
    box-shadow: var(--shadow-md);
    border: 1px solid var(--surface-border);
  }

  .club-leagues-table-wrapper {
    overflow-x: auto;
  }

  .club-leagues-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 0.95rem;
  }

  .club-leagues-table thead th {
    background: var(--surface-light);
    color: var(--text-primary);
    font-weight: 700;
    padding: 1.25rem 1.5rem;
    text-align: left;
    border-bottom: 2px solid var(--surface-border);
    font-size: 0.875rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }

  .club-leagues-table thead th i {
    margin-right: 0.5rem;
    color: var(--primary-green);
  }

  .club-leagues-table tbody tr {
    border-bottom: 1px solid var(--surface-border);
    transition: var(--transition);
    background: var(--background-light);
  }

  .club-leagues-table tbody tr:hover {
    background: var(--surface-light);
  }

  .club-leagues-table tbody td {
    padding: 1.5rem;
    vertical-align: middle;
  }

  .league-details-cell {
    min-width: 250px;
  }

  .league-info {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }

  .league-title {
    margin: 0;
    color: var(--text-primary);
    font-size: 1.125rem;
    font-weight: 600;
  }

  .league-meta {
    display: flex;
    gap: 1rem;
    flex-wrap: wrap;
  }

  .league-code,
  .tour-indicator {
    display: flex;
    align-items: center;
    gap: 0.375rem;
    font-size: 0.875rem;
    color: var(--text-secondary);
    font-weight: 500;
  }

  .league-code i,
  .tour-indicator i {
    color: var(--primary-green);
    font-size: 0.75rem;
  }

  .entries-cell {
    min-width: 120px;
  }

  .entries-display {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.25rem;
  }

  .entries-count {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--text-primary);
  }

  .entries-label {
    font-size: 0.75rem;
    color: var(--text-secondary);
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }

  .status-cell {
    min-width: 120px;
  }

  .actions-cell {
    min-width: 200px;
  }

  .action-buttons {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
    align-items: stretch;
  }

  .share-section {
    background: var(--surface-light);
    border-radius: var(--border-radius);
    padding: 1rem;
    border: 1px solid var(--surface-border);
  }

  .share-item {
    margin-bottom: 0.75rem;
  }

  .share-item:last-child {
    margin-bottom: 0;
  }

  .share-label {
    display: block;
    font-size: 0.75rem;
    font-weight: 600;
    color: var(--text-secondary);
    margin-bottom: 0.375rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }

  .copy-group {
    display: flex;
    gap: 0.5rem;
  }

  .copy-input {
    flex: 1;
    padding: 0.5rem 0.75rem;
    border: 1px solid var(--surface-border);
    border-radius: var(--border-radius);
    font-size: 0.875rem;
    background: var(--white);
    color: var(--text-secondary);
  }

  .copy-input:focus {
    outline: none;
    border-color: var(--primary-green);
  }

  .btn-sm {
    padding: 0.5rem 0.75rem;
    font-size: 0.875rem;
    min-height: 36px;
  }

  .btn-lg {
    padding: 1rem 2rem;
    font-size: 1.125rem;
    min-height: 52px;
  }

  .copy-btn.success {
    background: var(--success-gradient) !important;
    color: white !important;
  }

  .btn-danger {
    background: linear-gradient(135deg, #e53e3e 0%, #fc8181 100%);
    color: white;
    border: none;
  }

  .btn-danger:hover {
    background: linear-gradient(135deg, #c53030 0%, #e53e3e 100%);
    transform: translateY(-1px);
  }

  /* Empty State */
  .empty-leagues-content {
    text-align: center;
    padding: 4rem 2rem;
    color: var(--text-muted);
  }

  .empty-leagues-content i {
    font-size: 4rem;
    margin-bottom: 1.5rem;
    color: var(--primary-green);
    opacity: 0.7;
  }

  .empty-leagues-content h4 {
    color: var(--text-primary);
    font-size: 1.5rem;
    font-weight: 600;
    margin-bottom: 0.75rem;
  }

  .empty-leagues-content p {
    color: var(--text-secondary);
    font-size: 1.125rem;
    margin-bottom: 2rem;
    max-width: 400px;
    margin-left: auto;
    margin-right: auto;
  }

  /* Wallet Section */
  .wallet-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
    gap: 2rem;
    margin-bottom: 3rem;
  }

  .wallet-card {
    background: var(--white);
    border: 1px solid var(--surface-border);
    border-radius: var(--border-radius-lg);
    overflow: hidden;
    box-shadow: var(--shadow-sm);
  }

  .wallet-card-header {
    background: var(--surface-light);
    padding: 1.5rem;
    border-bottom: 1px solid var(--surface-border);
  }

  .wallet-card-header h3 {
    margin: 0;
    color: var(--text-primary);
    font-size: 1.25rem;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 0.75rem;
  }

  .wallet-card-body {
    padding: 2rem;
  }

  .alert {
    display: flex;
    align-items: flex-start;
    gap: 1rem;
    padding: 1.25rem;
    border-radius: var(--border-radius);
    margin-bottom: 1.5rem;
  }

  .alert.warning {
    background: var(--warning-bg);
    color: var(--warning-text);
    border: 1px solid #f6e05e;
  }

  .alert.success {
    background: #f0fff4;
    color: #22543d;
    border: 1px solid #9ae6b4;
  }

  .alert i {
    font-size: 1.25rem;
    margin-top: 0.125rem;
    flex-shrink: 0;
  }

  .alert div strong {
    display: block;
    font-weight: 700;
    margin-bottom: 0.25rem;
  }

  .feature-list {
    list-style: none;
    padding: 0;
    margin: 1.5rem 0;
  }

  .feature-list li {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 0.5rem 0;
    color: var(--text-secondary);
  }

  .feature-list li i {
    color: var(--primary-green);
    font-size: 1rem;
    width: 16px;
  }

  .stripe-connect-form {
    margin-top: 2rem;
  }

  .revenue-stats {
    display: grid;
    grid-template-columns: 1fr;
    gap: 1.5rem;
    margin-bottom: 2rem;
  }

  .revenue-stat {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1.25rem;
    background: var(--surface-light);
    border-radius: var(--border-radius);
    border: 1px solid var(--surface-border);
  }

  .revenue-stat-icon {
    width: 50px;
    height: 50px;
    background: var(--primary-gradient);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 1.25rem;
    flex-shrink: 0;
  }

  .revenue-stat-info {
    display: flex;
    flex-direction: column;
  }

  .revenue-stat-value {
    font-size: 1.75rem;
    font-weight: 700;
    color: var(--text-primary);
    line-height: 1;
  }

  .revenue-stat-label {
    font-size: 0.875rem;
    color: var(--text-secondary);
    font-weight: 500;
    margin-top: 0.25rem;
  }

  .revenue-info h5 {
    color: var(--text-primary);
    font-size: 1.125rem;
    font-weight: 600;
    margin-bottom: 0.75rem;
  }

  .revenue-info p {
    color: var(--text-secondary);
    line-height: 1.6;
    margin-bottom: 1rem;
  }

  .revenue-example {
    background: var(--surface-light);
    padding: 1rem;
    border-radius: var(--border-radius);
    border-left: 4px solid var(--primary-green);
    font-size: 0.9rem;
    color: var(--text-primary);
  }

  /* Mobile Responsive */
  @media (max-width: 1024px) {
    .action-buttons {
      flex-direction: row;
      flex-wrap: wrap;
    }

    .share-section {
      order: -1;
      width: 100%;
    }

    .wallet-grid {
      grid-template-columns: 1fr;
    }
  }

  @media (max-width: 768px) {
    .club-leagues-table thead {
      display: none;
    }

    .club-leagues-table,
    .club-leagues-table tbody,
    .club-leagues-table tr,
    .club-leagues-table td {
      display: block;
    }

    .league-row {
      background: var(--white);
      border: 1px solid var(--surface-border);
      border-radius: var(--border-radius);
      margin-bottom: 1rem;
      padding: 0;
      box-shadow: var(--shadow-sm);
    }

    .club-leagues-table tbody td {
      padding: 1rem;
      border: none;
      position: relative;
    }

    .club-leagues-table tbody td:before {
      content: attr(data-label);
      font-weight: 600;
      color: var(--text-secondary);
      font-size: 0.875rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      display: block;
      margin-bottom: 0.5rem;
    }

    .league-details-cell:before {
      content: "League";
    }

    .entries-cell:before {
      content: "Entries";
    }

    .status-cell:before {
      content: "Status";
    }

    .actions-cell:before {
      content: "Actions";
    }

    .action-buttons {
      flex-direction: column;
    }

    .copy-group {
      flex-direction: column;
    }

    .copy-input {
      margin-bottom: 0.5rem;
    }

    .revenue-stats {
      grid-template-columns: 1fr;
    }

    .wallet-card-body {
      padding: 1.5rem;
    }
  }

  @media (max-width: 480px) {
    .club-leagues-table tbody td {
      padding: 0.75rem;
    }

    .league-row {
      margin-bottom: 0.75rem;
    }

    .revenue-stat {
      padding: 1rem;
    }

    .revenue-stat-icon {
      width: 40px;
      height: 40px;
      font-size: 1rem;
    }

    .revenue-stat-value {
      font-size: 1.5rem;
    }

    .btn-sm {
      padding: 0.625rem 1rem;
      font-size: 0.8rem;
    }
  }

  /* Loading states */
  .btn:disabled {
    opacity: 0.6;
    cursor: not-allowed;
    transform: none !important;
  }

  .btn:disabled:hover {
    transform: none !important;
  }

  /* Success animations */
  @keyframes successPulse {
    0% {
      transform: scale(1);
    }
    50% {
      transform: scale(1.05);
    }
    100% {
      transform: scale(1);
    }
  }

  .copy-btn.success {
    animation: successPulse 0.3s ease-out;
  }

  /* League Controls Styles */
  .league-controls {
    background: var(--white);
    border: 1px solid var(--surface-border);
    border-radius: var(--border-radius-lg);
    padding: 1.25rem;
    margin-bottom: 1.5rem;
    box-shadow: var(--shadow-sm);
  }

  .search-filter-row {
    display: flex;
    gap: 1rem;
    flex-wrap: wrap;
    align-items: center;
  }

  .search-box {
    flex: 1;
    min-width: 250px;
    position: relative;
    display: flex;
    align-items: center;
  }

  .search-box i {
    position: absolute;
    left: 1rem;
    color: var(--text-secondary);
    pointer-events: none;
  }

  .search-input {
    width: 100%;
    padding: 0.75rem 1rem 0.75rem 2.75rem;
    border: 1px solid var(--surface-border);
    border-radius: var(--border-radius);
    font-size: 0.95rem;
    transition: var(--transition);
  }

  .search-input:focus {
    outline: none;
    border-color: var(--primary-green);
    box-shadow: 0 0 0 3px rgba(0, 133, 95, 0.1);
  }

  .filter-group {
    display: flex;
    gap: 0.75rem;
    flex-wrap: wrap;
  }

  .filter-select {
    padding: 0.75rem 1rem;
    border: 1px solid var(--surface-border);
    border-radius: var(--border-radius);
    font-size: 0.9rem;
    background: var(--white);
    color: var(--text-primary);
    cursor: pointer;
    transition: var(--transition);
    min-width: 150px;
  }

  .filter-select:hover {
    border-color: var(--primary-green);
  }

  .filter-select:focus {
    outline: none;
    border-color: var(--primary-green);
    box-shadow: 0 0 0 3px rgba(0, 133, 95, 0.1);
  }

  .bulk-actions-row {
    margin-top: 1rem;
    padding-top: 1rem;
    border-top: 1px solid var(--surface-border);
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 1rem;
  }

  .bulk-actions-info {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    font-weight: 600;
    color: var(--text-primary);
  }

  .bulk-actions-info input[type="checkbox"] {
    width: 18px;
    height: 18px;
    cursor: pointer;
  }

  .bulk-actions-buttons {
    display: flex;
    gap: 0.75rem;
  }

  .league-checkbox,
  .league-checkbox-header {
    width: 18px;
    height: 18px;
    cursor: pointer;
    accent-color: var(--primary-green);
  }

  /* Mobile adjustments for controls */
  @media (max-width: 768px) {
    .search-filter-row {
      flex-direction: column;
    }

    .search-box {
      width: 100%;
      min-width: 100%;
    }

    .filter-group {
      width: 100%;
    }

    .filter-select {
      flex: 1;
      min-width: 120px;
    }

    .bulk-actions-row {
      flex-direction: column;
      align-items: flex-start;
    }

    .bulk-actions-buttons {
      width: 100%;
      flex-direction: column;
    }

    .bulk-actions-buttons button {
      width: 100%;
    }
  }

  /* Communication Modal Styles */
  .modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.6);
    backdrop-filter: blur(4px);
    z-index: 10000;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 1rem;
    animation: fadeIn 0.2s ease-out;
  }

  @keyframes fadeIn {
    from {
      opacity: 0;
    }
    to {
      opacity: 1;
    }
  }

  .modal-content {
    background: var(--white);
    border-radius: var(--border-radius-lg);
    max-width: 600px;
    width: 100%;
    max-height: 90vh;
    overflow-y: auto;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    animation: slideUp 0.3s ease-out;
  }

  @keyframes slideUp {
    from {
      transform: translateY(30px);
      opacity: 0;
    }
    to {
      transform: translateY(0);
      opacity: 1;
    }
  }

  .modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1.5rem 2rem;
    border-bottom: 1px solid var(--surface-border);
  }

  .modal-header h2 {
    margin: 0;
    color: var(--text-primary);
    font-size: 1.5rem;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 0.75rem;
  }

  .modal-header h2 i {
    color: var(--primary-green);
  }

  .modal-close {
    background: none;
    border: none;
    color: var(--text-secondary);
    font-size: 1.5rem;
    cursor: pointer;
    padding: 0.5rem;
    border-radius: var(--border-radius);
    transition: var(--transition);
    line-height: 1;
  }

  .modal-close:hover {
    background: var(--surface-light);
    color: var(--text-primary);
  }

  .modal-body {
    padding: 2rem;
  }

  .alert.info {
    background: #e6f7ff;
    color: #0c5460;
    border: 1px solid #bee5eb;
  }

  .form-group {
    margin-bottom: 1.5rem;
  }

  .form-group label {
    display: block;
    font-weight: 600;
    color: var(--text-primary);
    margin-bottom: 0.5rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .form-group label i {
    color: var(--primary-green);
    font-size: 0.875rem;
  }

  .form-control {
    width: 100%;
    padding: 0.75rem 1rem;
    border: 1px solid var(--surface-border);
    border-radius: var(--border-radius);
    font-size: 0.95rem;
    font-family: inherit;
    transition: var(--transition);
  }

  .form-control:focus {
    outline: none;
    border-color: var(--primary-green);
    box-shadow: 0 0 0 3px rgba(0, 133, 95, 0.1);
  }

  textarea.form-control {
    resize: vertical;
    min-height: 120px;
  }

  .form-text {
    display: block;
    margin-top: 0.5rem;
    font-size: 0.8rem;
    color: var(--text-secondary);
  }

  .modal-footer {
    display: flex;
    gap: 0.75rem;
    justify-content: flex-end;
    margin-top: 2rem;
    padding-top: 1.5rem;
    border-top: 1px solid var(--surface-border);
  }

  @media (max-width: 768px) {
    .modal-content {
      max-width: 95vw;
      max-height: 95vh;
    }

    .modal-header,
    .modal-body {
      padding: 1.25rem;
    }

    .modal-footer {
      flex-direction: column;
    }

    .modal-footer button {
      width: 100%;
    }
  }

  /* Template Styles */
  .templates-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
    gap: 1.5rem;
    margin-top: 1.5rem;
  }

  .template-card {
    background: var(--white);
    border: 2px solid var(--surface-border);
    border-radius: var(--border-radius-lg);
    overflow: hidden;
    transition: var(--transition);
  }

  .template-card:hover {
    border-color: var(--primary-green);
    transform: translateY(-2px);
    box-shadow: var(--shadow-md);
  }

  .template-card-header {
    padding: 1.25rem;
    background: var(--surface-light);
    border-bottom: 1px solid var(--surface-border);
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .template-card-header h3 {
    margin: 0;
    font-size: 1.125rem;
    font-weight: 600;
    color: var(--text-primary);
  }

  .template-badge {
    background: var(--primary-gradient);
    color: white;
    padding: 0.25rem 0.75rem;
    border-radius: 20px;
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
  }

  .template-card-body {
    padding: 1.25rem;
  }

  .template-description {
    color: var(--text-secondary);
    font-size: 0.9rem;
    margin-bottom: 1rem;
    line-height: 1.5;
  }

  .template-stats {
    display: flex;
    gap: 1rem;
    flex-wrap: wrap;
  }

  .template-stat {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    color: var(--text-secondary);
    font-size: 0.875rem;
  }

  .template-stat i {
    color: var(--primary-green);
  }

  .template-card-actions {
    padding: 1rem 1.25rem;
    background: var(--surface-light);
    border-top: 1px solid var(--surface-border);
    display: flex;
    gap: 0.5rem;
  }

  .empty-state {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 4rem 2rem;
    text-align: center;
    color: var(--text-muted);
  }

  .empty-state i {
    font-size: 4rem;
    margin-bottom: 1.5rem;
    color: var(--primary-green);
    opacity: 0.5;
  }

  .empty-state h3 {
    color: var(--text-primary);
    font-size: 1.5rem;
    font-weight: 600;
    margin-bottom: 0.75rem;
  }

  .empty-state p {
    color: var(--text-secondary);
    font-size: 1.125rem;
    margin-bottom: 2rem;
    max-width: 400px;
  }

  /* Form Styles */
  .form-row {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
  }

  .form-section {
    margin: 1.5rem 0;
    padding: 1.5rem;
    background: var(--surface-light);
    border-radius: var(--border-radius);
  }

  .form-section h4 {
    margin: 0 0 1rem 0;
    color: var(--text-primary);
    font-size: 1rem;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .form-section h4 i {
    color: var(--primary-green);
  }

  .bucket-picks-grid {
    display: grid;
    grid-template-columns: repeat(5, 1fr);
    gap: 1rem;
  }

  .checkbox-group {
    display: flex;
    align-items: center;
  }

  .checkbox-group label {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    cursor: pointer;
    user-select: none;
  }

  .checkbox-group input[type="checkbox"] {
    width: 20px;
    height: 20px;
    cursor: pointer;
    accent-color: var(--primary-green);
  }

  .modal-large {
    max-width: 800px;
  }

  @media (max-width: 768px) {
    .templates-grid {
      grid-template-columns: 1fr;
    }

    .bucket-picks-grid {
      grid-template-columns: repeat(2, 1fr);
    }

    .form-row {
      grid-template-columns: 1fr;
    }
  }

  @media (max-width: 480px) {
    .bucket-picks-grid {
      grid-template-columns: 1fr;
    }
  }
</style>

{% endblock %}
