{% extends 'base.html' %} {% block head %}
<!-- Enhanced fonts for professional look -->
<link rel="preconnect" href="https://fonts.googleapis.com" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
<link
  href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap"
  rel="stylesheet"
/>

<!-- Dashboard data for JavaScript -->
<script>
  window.serverTimeNow = new Date({{ now | tojson }});
  window.liveLeaguesData = {{ live_leagues | tojson }};
  window.upcomingLeaguesData = {{ upcoming_leagues | tojson }};
  window.pastLeaguesData = {{ past_leagues | tojson }};
</script>
{% endblock %} {% block content %}
<div class="dashboard-wrapper">
  <!-- Professional Sidebar -->
  {% include 'main/_shared_side_navbar.html' with context %}

  <!-- Mobile Navigation -->
  {% include 'main/_shared_bottom_navbar.html' with context %}

  <!-- Main Dashboard Content -->
  <main class="dashboard-content">
    <!-- Professional Hero Section -->
    <header class="dashboard-hero">
      <div class="user-info">
        <div class="avatar">{{ current_user.full_name[0]|upper }}</div>

        <div class="user-details">
          <div class="welcome-message">
            <h1>Welcome back, {{ current_user.full_name.split(' ')[0] }}!</h1>
            <p class="dashboard-subheading">
              Here's a look at your current leagues and performance.
            </p>
          </div>

          <div class="join-league-box">
            <button class="join-league-hero-btn" id="join-league-hero-btn">
              <i class="fa-solid fa-plus"></i>
              Join a League
            </button>
          </div>
        </div>
      </div>

      <!-- Professional Stats Grid -->
      <div class="stats-grid">
        <div class="stat-card">
          <span class="value"
            >{{ live_leagues|length + upcoming_leagues|length }}</span
          >
          <span class="label">Active Leagues</span>
        </div>
        <div class="stat-card">
          <span class="value">{{ stats.leagues_played }}</span>
          <span class="label">Total Entered</span>
        </div>
        <div class="stat-card">
          <span class="value">{{ stats.leagues_won }}</span>
          <span class="label">Leagues Won</span>
        </div>
      </div>
    </header>

    <!-- Main Content Container -->
    <div class="content-container">
      <!-- Dashboard Section - My Leagues -->
      <section id="dashboard-section" class="page-section">
        <div class="leagues-section">
          <h2>
            <i class="fa-solid fa-trophy"></i>
            My Leagues
          </h2>

          <!-- Professional Tab Navigation -->
          <div class="tabs-container">
            <div class="tabs capsule-tabs league-tabs" id="league-tabs">
              <button class="tab-button active" data-status="live">
                <i class="fa-solid fa-circle"></i>
                Live
              </button>
              <button class="tab-button" data-status="upcoming">
                <i class="fa-solid fa-clock"></i>
                Upcoming
              </button>
              <button class="tab-button" data-status="past">
                <i class="fa-solid fa-flag-checkered"></i>
                Past
              </button>
            </div>
          </div>

          <!-- League Cards Grid -->
          <div class="leagues-grid" id="leagues-grid">
            <!-- League cards will be populated by JavaScript -->
          </div>

          <!-- Empty State -->
          <div class="empty-state" id="empty-state" style="display: none">
            <div class="empty-content">
              <i class="fa-solid fa-trophy"></i>
              <h3>No leagues found</h3>
              <p>You haven't joined any leagues in this category yet.</p>
              <button class="btn" id="join-first-league-btn">
                <i class="fa-solid fa-plus"></i>
                Join Your First League
              </button>
            </div>
          </div>
        </div>
      </section>

      <!-- Settings Section -->
      <section id="settings-section" class="page-section hidden">
        <header class="dashboard-header">
          <div>
            <h1>
              <i class="fa-solid fa-gear"></i>
              Account Settings
            </h1>
            <p class="subtitle">
              Manage your account preferences and notification settings
            </p>
          </div>
        </header>

        <!-- Add Profile Section -->
        <div class="settings-grid">
          <!-- Profile Settings Card -->
          <div class="settings-card">
            <div class="settings-card-header">
              <h3>
                <i class="fa-solid fa-user"></i>
                My Profile
              </h3>
            </div>
            <div class="settings-card-body">
              <div class="profile-header">
                <div class="avatar-placeholder">
                  {{ current_user.full_name[0]|upper }}
                </div>
                <div class="profile-info">
                  <h4>{{ current_user.full_name }}</h4>
                  <p>Fantasy Golf Player</p>
                </div>
              </div>

              <div class="profile-actions">
                <a
                  href="{{ url_for('main.my_profile') }}"
                  class="btn btn-primary"
                >
                  <i class="fa-solid fa-user"></i>
                  View Full Profile
                </a>
              </div>
            </div>
          </div>

          <!-- Account Settings Card -->
          <div class="settings-card">
            <div class="settings-card-header">
              <h3>
                <i class="fa-solid fa-cog"></i>
                Account Settings
              </h3>
            </div>
            <div class="settings-card-body">
              <div class="toggle-group">
                <div class="toggle-info">
                  <h5>Email Notifications</h5>
                  <p>
                    Receive updates about league results and new tournaments
                  </p>
                </div>
                <label class="switch">
                  <input type="checkbox" checked />
                  <span class="slider"></span>
                </label>
              </div>

              <div class="toggle-group">
                <div class="toggle-info">
                  <h5>SMS Notifications</h5>
                  <p>Get text messages for important league updates</p>
                </div>
                <label class="switch">
                  <input type="checkbox" />
                  <span class="slider"></span>
                </label>
              </div>

              <div class="toggle-group">
                <div class="toggle-info">
                  <h5>Public Profile</h5>
                  <p>Allow other users to view your profile and statistics</p>
                </div>
                <label class="switch">
                  <input type="checkbox" checked />
                  <span class="slider"></span>
                </label>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Include Shared Dashboard Sections -->
      {% include 'main/_shared_dashboard_sections.html' with context %}
    </div>
  </main>
</div>

<!-- Import and initialize the professional dashboard JavaScript -->
<script type="module">
  import { setupModalHandlers } from '{{ url_for("static", filename="js/ui.js") }}';
  import {
    renderProfessionalLeagueCards,
    renderEmptyState,
  } from '{{ url_for("static", filename="js/views.js") }}';

  document.addEventListener("DOMContentLoaded", function () {
    console.log("Professional User Dashboard Initialized");

    // DEBUG: Check if the hero join league button exists
    const joinLeagueHeroBtn = document.getElementById("join-league-hero-btn");
    console.log("Join league HERO button found:", joinLeagueHeroBtn);

    // DEBUG: Check if nav join league button exists
    const joinLeagueNavBtn = document.getElementById("join-league-btn");
    console.log("Join league NAV button found:", joinLeagueNavBtn);

    // DEBUG: Check if the modal exists
    const modal = document.getElementById("join-league-overlay");
    console.log("Join league modal found:", modal);

    // Initialize modal handlers from ui.js
    console.log("Setting up modal handlers...");
    setupModalHandlers();
    console.log("Modal handlers setup complete");

    // DEBUG: Manually test the HERO button click
    if (joinLeagueHeroBtn) {
      joinLeagueHeroBtn.addEventListener("click", function (e) {
        console.log("Hero join league button clicked!");
        e.preventDefault();
      });
    }

    // League data from server
    const liveLeagues = window.liveLeaguesData || [];
    const upcomingLeagues = window.upcomingLeaguesData || [];
    const pastLeagues = window.pastLeaguesData || [];

    // DOM elements
    const tabButtons = document.querySelectorAll(".tab-button");
    const leaguesGrid = document.getElementById("leagues-grid");
    const emptyState = document.getElementById("empty-state");

    // Current active status
    let currentStatus = "live";

    // Render leagues function using views.js
    function renderLeagues(status) {
      let leagues = [];

      switch (status) {
        case "live":
          leagues = liveLeagues;
          break;
        case "upcoming":
          leagues = upcomingLeagues;
          break;
        case "past":
          leagues = pastLeagues;
          break;
      }

      if (leagues.length === 0) {
        leaguesGrid.style.display = "none";
        emptyState.style.display = "block";

        // Use the renderEmptyState function from views.js
        renderEmptyState(emptyState.querySelector(".empty-content"), status);
      } else {
        leaguesGrid.style.display = "grid";
        emptyState.style.display = "none";

        // Use the professional league card renderer from views.js
        renderProfessionalLeagueCards(leagues, leaguesGrid);
      }
    }

    // Tab switching functionality
    tabButtons.forEach((button) => {
      button.addEventListener("click", () => {
        // Update active tab
        tabButtons.forEach((btn) => btn.classList.remove("active"));
        button.classList.add("active");

        // Update current status and render
        currentStatus = button.dataset.status;
        renderLeagues(currentStatus);
      });
    });

    // Initial render
    renderLeagues("live");

    console.log(
      "Dashboard loaded with",
      {
        live: liveLeagues.length,
        upcoming: upcomingLeagues.length,
        past: pastLeagues.length,
      },
      "leagues"
    );
  });
</script>

<style>
  /* Additional Professional Styles */
  .empty-content {
    text-align: center;
    padding: 4rem 2rem;
    color: var(--text-muted);
    background: var(--white);
    border-radius: var(--border-radius-lg);
    border: 2px dashed var(--surface-border);
  }

  .empty-content i {
    font-size: 4rem;
    color: var(--text-muted);
    opacity: 0.5;
  }

  .empty-content h3 {
    color: var(--text-primary);
    font-size: 1.5rem;
    font-weight: 600;
    margin-bottom: 0.75rem;
  }

  .empty-content p {
    color: var(--text-secondary);
    font-size: 1.125rem;
    margin-bottom: 2rem;
    max-width: 400px;
    margin-left: auto;
    margin-right: auto;
  }

  /* Settings Grid */
  .settings-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
    gap: 2rem;
    margin-bottom: 3rem;
  }

  .settings-card {
    background: var(--white);
    border: 1px solid var(--surface-border);
    border-radius: var(--border-radius-lg);
    overflow: hidden;
    box-shadow: var(--shadow-sm);
  }

  .settings-card-header {
    background: var(--surface-light);
    padding: 1.5rem;
    border-bottom: 1px solid var(--surface-border);
  }

  .settings-card-header h3 {
    margin: 0;
    color: var(--text-primary);
    font-size: 1.25rem;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 0.75rem;
  }

  .settings-card-body {
    padding: 2rem;
  }

  .profile-header {
    display: flex;
    align-items: center;
    gap: 1.5rem;
    margin-bottom: 2rem;
    padding-bottom: 1.5rem;
    border-bottom: 1px solid var(--surface-border);
  }

  .avatar-placeholder {
    width: 80px;
    height: 80px;
    background: var(--primary-gradient);
    color: var(--white);
    font-size: 1.5rem;
    font-weight: 700;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    border: 3px solid var(--surface-border);
  }

  .profile-info h4 {
    margin: 0 0 0.25rem 0;
    color: var(--text-primary);
    font-size: 1.25rem;
    font-weight: 600;
  }

  .profile-info p {
    margin: 0;
    color: var(--text-secondary);
    font-size: 1rem;
  }

  .form-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1rem;
    margin-bottom: 1rem;
  }

  .input-group {
    display: flex;
    flex-direction: column;
    margin-bottom: 1rem;
  }

  .input-group label {
    margin-bottom: 0.5rem;
    font-weight: 600;
    color: var(--text-primary);
    font-size: 0.9rem;
  }

  .input-group input {
    padding: 0.75rem 1rem;
    border: 1px solid var(--surface-border);
    border-radius: var(--border-radius);
    font-size: 1rem;
    transition: var(--transition);
    background: var(--white);
  }

  .input-group input:focus {
    outline: none;
    border-color: var(--primary-green);
    box-shadow: 0 0 0 3px rgba(0, 106, 78, 0.1);
  }

  .form-actions {
    display: flex;
    justify-content: flex-end;
    gap: 1rem;
    margin-top: 2rem;
  }

  .toggle-group {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    padding: 1.5rem 0;
    border-bottom: 1px solid var(--surface-border);
    gap: 2rem;
  }

  .toggle-group:last-child {
    border-bottom: none;
  }

  .toggle-info {
    flex: 1;
  }

  .toggle-info h5 {
    margin: 0 0 0.5rem 0;
    color: var(--text-primary);
    font-size: 1rem;
    font-weight: 600;
  }

  .toggle-info p {
    margin: 0;
    color: var(--text-secondary);
    font-size: 0.9rem;
    line-height: 1.4;
  }

  .switch {
    position: relative;
    display: inline-block;
    width: 50px;
    height: 28px;
    flex-shrink: 0;
  }

  .switch input {
    opacity: 0;
    width: 0;
    height: 0;
  }

  .slider {
    position: absolute;
    cursor: pointer;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: #ccc;
    transition: var(--transition);
    border-radius: 34px;
  }

  .slider:before {
    position: absolute;
    content: "";
    height: 20px;
    width: 20px;
    left: 4px;
    bottom: 4px;
    background-color: white;
    transition: var(--transition);
    border-radius: 50%;
  }

  input:checked + .slider {
    background-color: var(--primary-green);
  }

  input:checked + .slider:before {
    transform: translateX(22px);
  }

  /* Mobile Responsive */
  @media (max-width: 768px) {
    .settings-grid {
      grid-template-columns: 1fr;
      gap: 1.5rem;
    }

    .form-row {
      grid-template-columns: 1fr;
    }

    .profile-header {
      flex-direction: column;
      text-align: center;
      gap: 1rem;
    }

    .toggle-group {
      flex-direction: column;
      gap: 1rem;
      align-items: flex-start;
    }

    .form-actions {
      justify-content: stretch;
    }

    .form-actions .btn {
      width: 100%;
    }
  }

  @media (max-width: 480px) {
    .settings-card-body {
      padding: 1.5rem;
    }

    .settings-card-header {
      padding: 1rem;
    }

    .avatar-placeholder {
      width: 60px;
      height: 60px;
      font-size: 1.25rem;
    }

    .toggle-group {
      padding: 1rem 0;
    }
  }
</style>

{% endblock %}
