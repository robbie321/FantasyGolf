<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="csrf-token" content="{{ csrf_token() }}" />
    <title>Fantasy Fairways</title>
    <!-- Add Google Fonts Link -->

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="manifest"
      href="{{ url_for('static', filename='manifest.json') }}"
    />
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/style.css') }}"
    />
    <link
      href="{{ url_for('static', filename='css/fa/css/fontawesome.css') }}"
      rel="stylesheet"
    />
    <link
      href="{{ url_for('static', filename='css/fa/css/brands.css') }}"
      rel="stylesheet"
    />
    <link
      href="{{ url_for('static', filename='css/fa/css/solid.css') }}"
      rel="stylesheet"
    />

    <script
      type="module"
      src="{{ url_for('static', filename='js/main.js') }}"
    ></script>

    {% block head %}{% endblock %}
  </head>
  <body>
    {% block content %}{% endblock %}

    <div class="page-wrapper fade-in-section"></div>
    <div id="mobile-menu-overlay" class="mobile-menu-overlay"></div>

    <div class="toast-container">
      {% with messages = get_flashed_messages(with_categories=true) %} {% if
      messages %} {% for category, message in messages %}
      <div class="toast toast--{{ category }}">
        <div class="toast__content">
          <p class="toast__message">{{ message }}</p>
        </div>
        <button class="toast__close">&times;</button>
      </div>
      {% endfor %} {% endif %} {% endwith %}
    </div>

    <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->
    <!--      MOBILE NAVIGATION & MENU      -->
    <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->

    <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->
    <!--      JOIN LEAGUE MODAL           -->
    <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->
    <div class="modal-overlay hidden" id="join-league-overlay">
      <div class="modal" id="join-league-modal">
        <div class="modal-header">
          <h3><i class="fa-solid fa-user-plus"></i> Join League</h3>
          <button class="close-btn" id="modal-close-btn">&times;</button>
        </div>
        <p class="modal-subtitle">
          Enter your league invitation code to join an existing tournament
        </p>
        <div class="modal-body">
          <div class="icon-container">
            <i class="fa-solid fa-trophy"></i>
          </div>
          <form id="join-league-form">
            <div class="input-group">
              <label for="league-code">League Code</label>
              <input
                type="text"
                id="league-code"
                placeholder="Enter 6-digit code (e.g., ABC123)"
              />
            </div>
            <p class="modal-message" id="modal-message"></p>
          </form>
          <div class="info-box">
            <h4>How it works</h4>
            <ul>
              <li>Get your league code from the tournament organizer</li>
              <li>Enter the 6-digit code above</li>
              <li>You'll be added to the league instantly</li>
              <li>Start competing and tracking your progress</li>
            </ul>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-outline" id="modal-cancel-btn">Cancel</button>
          <button
            type="submit"
            form="join-league-form"
            class="btn btn-primary"
            id="join-league-submit-btn"
          >
            Join League
          </button>
        </div>
        <p class="modal-sub-link">
          Don't have a code? <a href="#">Contact your tournament organizer</a>
        </p>
      </div>
    </div>
    <script>
      function toggleDropdown() {
        document.getElementById("myDropdown").classList.toggle("show");
      }
      // Close dropdown if clicking outside
      window.onclick = function (event) {
        if (!event.target.matches(".dropdown-button")) {
          var dropdowns = document.getElementsByClassName("dropdown-content");
          for (var i = 0; i < dropdowns.length; i++) {
            var openDropdown = dropdowns[i];
            if (openDropdown.classList.contains("show")) {
              openDropdown.classList.remove("show");
            }
          }
        }
      };

      document.addEventListener("DOMContentLoaded", function () {
        const toggler = document.getElementById("navbar-toggler-btn");
        const linksContainer = document.getElementById(
          "navbar-links-container"
        );

        if (toggler && linksContainer) {
          toggler.addEventListener("click", function () {
            linksContainer.classList.toggle("is-active");
            toggler.classList.toggle("is-active");
          });
        }
      });

      // --- Toast Notification Logic ---
      document.addEventListener("DOMContentLoaded", () => {
        const toasts = document.querySelectorAll(".toast");

        toasts.forEach((toast, index) => {
          // Stagger the appearance of multiple toasts
          setTimeout(() => {
            toast.classList.add("show");
          }, index * 200);

          // Auto-hide after 5 seconds
          const timer = setTimeout(() => {
            toast.classList.remove("show");
            setTimeout(() => toast.remove(), 500); // Remove from DOM after animation
          }, 5000);

          // Allow manual closing
          const closeButton = toast.querySelector(".toast__close");
          if (closeButton) {
            closeButton.addEventListener("click", () => {
              clearTimeout(timer); // Stop auto-hide timer
              toast.classList.remove("show");
              setTimeout(() => toast.remove(), 500);
            });
          }
        });
      });

      // --- Dismiss PWA Prompt ---
      const pwaPrompt = document.getElementById("ios-pwa-prompt");
      const closePwaPromptBtn = document.getElementById("close-pwa-prompt");

      if (pwaPrompt && closePwaPromptBtn) {
        closePwaPromptBtn.addEventListener("click", () => {
          pwaPrompt.style.display = "none";
        });
      }

      if ("serviceWorker" in navigator) {
        window.addEventListener("load", () => {
          navigator.serviceWorker
            .register("/service-worker.js")
            .then((registration) => {
              console.log(
                "ServiceWorker registration successful with scope: ",
                registration.scope
              );
            })
            .catch((error) => {
              console.log("ServiceWorker registration failed: ", error);
            });
        });
      }
    </script>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        // Simple script to trigger the fade-in animation
        const sections = document.querySelectorAll(".fade-in-section");

        const observer = new IntersectionObserver(
          (entries) => {
            entries.forEach((entry) => {
              if (entry.isIntersecting) {
                entry.target.classList.add("is-visible");
              }
            });
          },
          { threshold: 0.1 }
        );

        sections.forEach((section) => {
          observer.observe(section);
        });
      });
    </script>
  </body>
</html>
